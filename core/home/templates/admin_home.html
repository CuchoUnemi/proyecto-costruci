{% extends 'components/base.html' %}
{% load static %}
<title>{% block title %} {{ title1 }} {% endblock title %}</title>
{% block content %}
<div class="w-full bg-white dark:bg-principal bg-slate-100 pt-6"></div>
    <div class="max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 mx-auto">
        <div class="relative p-6 md:p-16 bg-primary dark:bg-principal">
            <!-- Grid -->
            <div class="bg-white dark:bg-principal bg-slate-100 relative z-10 lg:grid lg:grid-cols-12 lg:gap-16 lg:items-center">
                <div class="lg:col-span-6 lg:col-start-8 lg:order-2">
                    {% if user.is_authenticated %}
                        {% if user.is_superuser %}
                            <span class="text-secondary text-orange-500 dark:text-orange-300 text-3xl font-black my-2 block">Bienvenido, {{ user.username }}.</span>
                        {% else %}
                            <span class="text-secondary text-orange-500 dark:text-orange-300 text-3xl font-black my-2 block">Bienvenido, {{ user.username }}.</span>
                        {% endif %}
                    {% else %}
                        <span class="text-secondary text-orange-500 dark:text-orange-300 text-3xl font-black my-2 block">Bienvenido, usuario anónimo.</span>
                    {% endif %}
                    <h2 class="text-2xl text-blue-500 font-bold sm:text-3xl dark:text-blue-300">¿Qué puedes hacer?</h2>

                    <!-- Tab Navs -->
                    <nav class="grid gap-4 mt-5 md:mt-10" aria-label="Tabs" role="tablist" aria-orientation="vertical">
                        <button type="button" class="tab-button text-start hover:bg-gray-200 focus:outline-none focus:bg-gray-200 p-4 md:p-5 rounded-xl bg-gray-100 dark:bg-gray-800 dark:text-gray-200 active" id="tabs-with-card-item-1" aria-selected="true" data-hs-tab="#tabs-with-card-1" aria-controls="tabs-with-card-1" role="tab">
                            <span class="flex gap-x-6">
                                <svg class="shrink-0 mt-2 size-6 md:size-7 tab-button-icon text-gray-800 dark:text-neutral-200" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M9 9h.01"/>
                                    <path d="M15 15h.01"/>
                                    <path d="M11 11h.01"/>
                                    <path d="M12 17h0"/>
                                    <path d="M11 11a4 4 0 1 1 4 0"/>
                                </svg>
                                <span class="grow">
                                    <span class="block text-lg font-semibold tab-title-text text-orange-500 dark:text-orange-300">Actualiza tu informacion</span>
                                    <span class="block mt-1 text-gray-600 dark:text-neutral-400">Visualiza y actualiza solo con un click.</span>
                                </span>
                            </span>
                        </button>
                    </nav>
                    
                    <!-- Buttons to update chart and chatbot -->
                    <div class="flex justify-center gap-4 mt-10"> <!-- Increased margin-top here -->
                        <!-- Button to update chart -->
                        <button id="updateChart" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 flex items-center">
                            <i class="fas fa-chart-bar mr-2"></i> Actualizar Gráfico
                        </button>

                        <!-- Button to update chatbot -->
                        <button id="updateChatbot" class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 flex items-center">
                            <i class="fas fa-sync-alt mr-2"></i> Actualizar Chatbot
                        </button>
                    </div>
                </div>

                <div class="lg:col-span-6">
                    <!-- Tab Content -->
                    <div class="tab-content">
                        <!-- Panel 1 -->
                        <div id="tabs-with-card-1" role="tabpanel" aria-labelledby="tabs-with-card-item-1">
                            <!-- Title for the chart -->
                            <h3 class="text-xl font-semibold mb-4 text-center text-gray-800 dark:text-gray-200">Preguntas más frecuentes</h3>
                            
                            <!-- Chart Placeholder -->
                            <div id="chart" class="h-[500px] md:h-[600px] rounded-xl"></div> <!-- Updated div for ApexCharts -->
                        </div>
                    </div>
                    <!-- End Tab Content -->
                </div>
            </div>
            <!-- End Grid -->
        </div>
    </div>
</div>

<!-- Include Font Awesome -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<!-- Include ApexCharts -->
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
    let chart; // Declare the chart variable globally

    function renderApexChart() {
        // Destroy previous chart instance if it exists
        if (chart) {
            chart.destroy();
        }

        // Create a new chart using ApexCharts
        chart = new ApexCharts(document.querySelector("#chart"), {
            chart: {
                type: 'area',
                height: '100%'
            },
            series: [{
                name: 'series1',
                data: [31, 40, 28, 51, 42, 109, 100]
            }, {
                name: 'series2',
                data: [11, 32, 45, 32, 34, 52, 41]
            }],
            xaxis: {
                categories: ['22:00', '23:00', '00:00', '01:00', '02:00', '03:00', '04:00']
            },
            colors: ['#008FFB', '#00E396'],
            stroke: {
                curve: 'smooth'
            },
            fill: {
                opacity: 0.3
            },
            title: {
                text: 'Area Chart',
                align: 'left'
            }
        });

        // Render the chart
        chart.render();
    }

    // Initialize the chart when the page loads
    document.addEventListener('DOMContentLoaded', function() {
        renderApexChart();

        // Add event listener to the button to update the chart
        document.getElementById('updateChart').addEventListener('click', function() {
            renderApexChart(); // Re-render the chart on button click
        });

        // Placeholder function for updating the chatbot
        document.getElementById('updateChatbot').addEventListener('click', function() {
            alert('El chatbot ha sido actualizado.');
        });
    });
</script>
{% endblock %}
